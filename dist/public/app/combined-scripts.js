"use strict";!function(){angular.module("brevesApp",["ngRoute","ngResource"]),angular.module("brevesApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/components/home/homeView.html",controller:"HomeCtrl"}).when("/subscribe",{templateUrl:"app/components/subscribe/subscribeView.html"}).when("/unsubscribe",{templateUrl:"app/components/unsubscribe/unsubscribeView.html"}).when("/suggestion",{templateUrl:"app/components/suggestion/suggestionView.html",controller:"SuggestionCtrl"}).otherwise("/")}]),angular.module("brevesApp").run(["$rootScope","$timeout","$location","scrollToNoReload",function(a,b,c,d){a.modalAlert=function(c){console.log(c),a.alert=c,b(function(){a.alert={}},c.duration||5e3)},a.gotoElement=function(a){console.log(c.hash().length),d.scrollTo(a)}}])}(),function(){angular.module("brevesApp").controller("BrevesMailCtrl",["$scope","Movies",function(a,b){b.success(function(b){a.movies=b})}])}(),function(){function a(){return{restrict:"E",templateUrl:"app/components/breves_mail/brevesMailView.html",controller:"BrevesMailCtrl"}}angular.module("brevesApp").directive("brevesMail",a)}(),function(){angular.module("brevesApp").controller("HomeCtrl",["$scope","$timeout","$location","List",function(a,b,c,d){a.jobs="jobs",d.success(function(b){a.list=b[0]}),a.mandrill_email_limit=4e3,a.hasHash=function(){return 0!==c.hash().length},a.$on("$viewContentLoaded",function(){console.log(angular.element(document.querySelector("#home"))),b(function(){angular.element(document.querySelector("#catch")).removeClass("invisible")},400).then(b(function(){angular.element(document.querySelector("#browser")).removeClass("invisible"),angular.element(document.querySelector("#over")).removeClass("invisible")},1500))})}])}(),function(){angular.module("brevesApp").controller("SuggestionCtrl",["$scope","$http","Suggestions",function(a,b,c){a.showAdditionalCreationFields=!1,a.form={},a.suggestions=c.query(),a.filterFunction=function(b){var c=new RegExp(a.suggestion_filter,"gi");return b.title.match(c)?!0:!1},a.createSuggestion=function(){console.log(a.createSuggestion),b.get("api/v1/helper/lists-for-email/"+a.createSuggestion.creatorEmail).success(function(b){if("error"===b.status)a.modalAlert({type:"error",message:"Seuls les personnes déjà inscrites à la newsletter peutvent proposer une suggestion."});else{a.form.createSuggestionForm.$setUntouched(),a.createSuggestion.voting=[],a.createSuggestion.voting.push(a.createSuggestion.creatorEmail);var d=new c(a.createSuggestion);console.log(d),d.$save(),a.suggestions.push(d),a.createSuggestion={},a.showAdditionalCreationFields=!1,a.modalAlert({type:"success",message:"Votre suggestion a été ajoutée."})}}).error(function(){console.log("Api error"),a.modalAlert({type:"error",message:"Une erreur s'est produite. Veuillez recommencer."})})},a.voteForSuggestion=function(d){console.log(d);var e=$.map(a.suggestions,function(a,b){return a._id==d?b:void 0})[0];return console.log(a.suggestions[e]),a.suggestions[e].votingEmail?-1!==a.suggestions[e].voting.indexOf(a.suggestions[e].votingEmail)?(console.log("Vous avez deja voté"),void a.modalAlert({type:"error",message:"Vous avez déjà voté. C'est pas bien de tricher."})):void b.get("api/v1/helper/lists-for-email/"+a.suggestions[e].votingEmail).success(function(b){if("error"===b.status)console.log("not a member"),a.modalAlert({type:"error",message:"Seuls les personnes déjà inscrites à la newsletter peuvent voter pour une suggestion."});else{a.suggestions[e].voting.push(a.suggestions[e].votingEmail);var d=new c(a.suggestions[e]);d.voteCount++,d.$update(function(){a.suggestions[e].voteCount++,a.modalAlert({type:"success",message:"Votre vote a bien été pris en compte"})},function(){console.log("update request failed"),a.modalAlert({type:"error",message:"Une erreur s'est produite, veuillez re-voter s'il vous plait."})})}}).error(function(){console.log("Api error"),a.modalAlert({type:"error",message:"Une erreur s'est produite, veuillez vérifier votre adresse email et voter à nouveau."})}):void console.log("email invalide (undefined)")}}])}(),function(){angular.module("brevesApp").directive("scrollTo",[function(){return{restrict:"A",link:function(a,b,c){var d=c.href;b.on("click",function(){var a;a=d?$(d):b,$("body").animate({scrollTop:a.offset().top-$("nav.navbar").height()},"slow")})}}}])}(),function(){angular.module("brevesApp").filter("iso8601Period",[function(){return function(a){var b=a.match(/(\d*)M(\d*)S/);return b[1]+" min"}}])}(),function(){angular.module("brevesApp").controller("SubscribeFormController",["$scope","$http","$rootScope",function(a,b){a.subscribeToList=function(){console.log(a.subscriber.email),b.post("/api/v1/lists/subscribe",{id:"b0e318dd95",email:a.subscriber.email}).success(function(){console.log("Tout va bien"),a.modalAlert({type:"success",message:"Votre demande à bien été prise en compte, un email vous à été envoyé."})}).error(function(b){a.modalAlert({type:"error",message:b}),console.log(b)})},a.unsubscribeToList=function(){console.log(a.unsubscriber.email),b.post("/api/v1/lists/unsubscribe",{id:"b0e318dd95",email:a.unsubscriber.email}).success(function(){console.log("Tout va bien"),a.modalAlert({type:"success",message:"Votre demande à bien été prise en compte, un email vous à été envoyé."})}).error(function(b){a.modalAlert({type:"error",message:b}),console.log(b)})}}])}(),function(){angular.module("brevesApp").controller("NavigationCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()},a.appName="Brèves arte+7",a.retracted=!0,a.toogleNav=function(){console.log(a.retracted),a.retracted=a.retracted?!1:!0}}])}(),function(){angular.module("brevesApp").directive("navigationPrimary",[function(){return{restrict:"E",templateUrl:"app/shared/navigation/navigationView.html",controller:"NavigationCtrl"}}])}(),function(){angular.module("brevesApp").factory("List",["$http",function(a){return a.get("/api/v1/lists/b0e318dd95")}])}(),function(){angular.module("brevesApp").factory("Movies",["$http",function(a){return a.get("/api/v1/movies/")}])}(),function(){angular.module("brevesApp").service("scrollToNoReload",[function(){this.scrollTo=function(a){function b(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function c(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!=document.body;)d=d.offsetParent,c+=d.offsetTop;return c-$("nav.navbar").height()}var d=b(),e=c(a),f=e>d?e-d:d-e;if(100>f)return void scrollTo(0,e);var g=Math.round(f/25);g>=20&&(g=20);var h=Math.round(f/25),i=e>d?d+h:d-h,j=0;if(e>d)for(var k=d;e>k;k+=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i+=h,i>e&&(i=e),j++;else for(var k=d;k>e;k-=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i-=h,e>i&&(i=e),j++}}])}(),function(){angular.module("brevesApp").factory("Suggestions",["$resource",function(a){return a("/api/v1/suggestions/:id",{id:"@_id"},{update:{method:"PUT"}})}])}();